{% extends "admin/base.html" %}

{% block page_title %}Paramètres Contenu Pub{% endblock %}

{% block main_content %}
<div class="max-w-4xl">
    <div class="mb-6">
        <a href="{{ url_for('ad_content.list_ads') }}" class="text-gray-500 hover:text-gray-700">
            <i class="fas fa-arrow-left mr-2"></i>Retour aux contenus
        </a>
    </div>

    <form method="POST" class="space-y-6">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-primary-100 rounded-lg flex items-center justify-center">
                    <i class="fas fa-percentage text-primary-600"></i>
                </div>
                <div>
                    <h2 class="text-lg font-semibold text-gray-800">Commission</h2>
                    <p class="text-sm text-gray-500">Configurez les taux de commission pour les établissements</p>
                </div>
            </div>
            
            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <label class="label">Taux de commission par défaut (%)</label>
                    <div class="relative">
                        <input type="number" name="ad_commission_rate" 
                               value="{{ settings.ad_commission_rate }}" 
                               min="0" max="100" step="0.1"
                               class="input-field pr-12">
                        <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">%</span>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">
                        Pourcentage du prix reversé aux établissements
                    </p>
                </div>
                <div>
                    <label class="label">Prix minimum par jour</label>
                    <div class="relative">
                        <input type="number" name="ad_min_price_per_day" 
                               value="{{ settings.ad_min_price_per_day }}" 
                               min="0" step="0.01"
                               class="input-field pr-12">
                        <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">EUR</span>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">
                        Prix minimum suggéré pour un jour de diffusion
                    </p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                    <i class="fas fa-file-invoice text-blue-600"></i>
                </div>
                <div>
                    <h2 class="text-lg font-semibold text-gray-800">Facturation automatique</h2>
                    <p class="text-sm text-gray-500">Gérez la génération des factures de commission</p>
                </div>
            </div>
            
            <div class="space-y-4">
                <label class="flex items-center gap-4 p-4 border rounded-xl cursor-pointer hover:bg-gray-50 transition group" id="auto-invoice-option">
                    <div class="relative">
                        <input type="checkbox" name="ad_auto_invoice" id="ad_auto_invoice"
                               class="sr-only peer"
                               {% if settings.ad_auto_invoice %}checked{% endif %}
                               onchange="toggleAutoInvoice()">
                        <div class="w-14 h-8 bg-gray-200 rounded-full peer-checked:bg-primary-500 transition-colors"></div>
                        <div class="absolute left-1 top-1 w-6 h-6 bg-white rounded-full shadow transition-transform peer-checked:translate-x-6"></div>
                    </div>
                    <div class="flex-1">
                        <div class="font-medium text-gray-800">Génération automatique des factures</div>
                        <p class="text-sm text-gray-500 mt-0.5">Les factures seront créées automatiquement selon la fréquence définie</p>
                    </div>
                    <div class="w-8 h-8 rounded-full flex items-center justify-center bg-gray-100 group-hover:bg-gray-200 transition" id="auto-invoice-icon">
                        <i class="fas fa-{% if settings.ad_auto_invoice %}check text-primary-600{% else %}times text-gray-400{% endif %}"></i>
                    </div>
                </label>
                
                <div id="frequency-section" class="{% if not settings.ad_auto_invoice %}opacity-50 pointer-events-none{% endif %} transition-opacity">
                    <label class="label">Fréquence de facturation</label>
                    <select name="ad_invoice_frequency" class="input-field">
                        <option value="weekly" {% if settings.ad_invoice_frequency == 'weekly' %}selected{% endif %}>
                            Hebdomadaire (chaque lundi)
                        </option>
                        <option value="biweekly" {% if settings.ad_invoice_frequency == 'biweekly' %}selected{% endif %}>
                            Bimensuelle (1er et 15 du mois)
                        </option>
                        <option value="monthly" {% if settings.ad_invoice_frequency == 'monthly' %}selected{% endif %}>
                            Mensuelle (1er du mois)
                        </option>
                        <option value="end_of_campaign" {% if settings.ad_invoice_frequency == 'end_of_campaign' %}selected{% endif %}>
                            Fin de campagne
                        </option>
                    </select>
                </div>
            </div>
        </div>

        <div class="bg-gradient-to-r from-primary-50 to-emerald-50 rounded-xl border border-primary-200 p-6">
            <div class="flex items-start gap-4">
                <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center flex-shrink-0 shadow-sm">
                    <i class="fas fa-lightbulb text-primary-500"></i>
                </div>
                <div>
                    <h3 class="font-semibold text-gray-800 mb-3">Comment fonctionne le système de commission ?</h3>
                    <div class="grid sm:grid-cols-2 gap-3">
                        <div class="flex items-start gap-2 bg-white/60 rounded-lg p-3">
                            <div class="w-6 h-6 bg-primary-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                <span class="text-xs font-bold text-primary-600">1</span>
                            </div>
                            <p class="text-sm text-gray-700">Vous vendez de l'espace publicitaire aux annonceurs</p>
                        </div>
                        <div class="flex items-start gap-2 bg-white/60 rounded-lg p-3">
                            <div class="w-6 h-6 bg-primary-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                <span class="text-xs font-bold text-primary-600">2</span>
                            </div>
                            <p class="text-sm text-gray-700">Le contenu est diffusé sur les écrans partenaires</p>
                        </div>
                        <div class="flex items-start gap-2 bg-white/60 rounded-lg p-3">
                            <div class="w-6 h-6 bg-primary-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                <span class="text-xs font-bold text-primary-600">3</span>
                            </div>
                            <p class="text-sm text-gray-700">Une commission est reversée aux établissements</p>
                        </div>
                        <div class="flex items-start gap-2 bg-white/60 rounded-lg p-3">
                            <div class="w-6 h-6 bg-primary-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                <span class="text-xs font-bold text-primary-600">4</span>
                            </div>
                            <p class="text-sm text-gray-700">Les factures sont générées automatiquement</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex items-center justify-end gap-3 pt-2">
            <a href="{{ url_for('ad_content.list_ads') }}" class="btn-secondary">
                Annuler
            </a>
            <button type="submit" class="btn-primary">
                <i class="fas fa-save mr-2"></i>
                Enregistrer les paramètres
            </button>
        </div>
    </form>
</div>

<script>
function toggleAutoInvoice() {
    const checkbox = document.getElementById('ad_auto_invoice');
    const frequencySection = document.getElementById('frequency-section');
    const icon = document.querySelector('#auto-invoice-icon i');
    const option = document.getElementById('auto-invoice-option');
    
    if (checkbox.checked) {
        frequencySection.classList.remove('opacity-50', 'pointer-events-none');
        icon.className = 'fas fa-check text-primary-600';
        option.classList.add('border-primary-500', 'bg-primary-50/50');
    } else {
        frequencySection.classList.add('opacity-50', 'pointer-events-none');
        icon.className = 'fas fa-times text-gray-400';
        option.classList.remove('border-primary-500', 'bg-primary-50/50');
    }
}

document.addEventListener('DOMContentLoaded', function() {
    const checkbox = document.getElementById('ad_auto_invoice');
    const option = document.getElementById('auto-invoice-option');
    if (checkbox.checked) {
        option.classList.add('border-primary-500', 'bg-primary-50/50');
    }
});
</script>
{% endblock %}
